
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>FL Kasa Takip</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #111;
      color: #eee;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: auto;
    }
    .box {
      background: #1d1d1d;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,255,200,0.1);
      margin-bottom: 20px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 10px;
      border: none;
      background: #333;
      color: #fff;
      box-shadow: 0 0 6px rgba(0,255,200,0.4);
    }
    button {
      background-color: #00bfa6;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #00e6ca;
    }
    .balance {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      color: #ff4b4b;
    }
    .tables {
      display: flex;
      flex-wrap: nowrap;
      gap: 20px;
      overflow-x: auto;
    }
    .half {
      flex: 1;
      min-width: 640px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #444;
      text-align: center;
    }
    th {
      background: #00bfa6;
      color: #fff;
    }
    .header-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .total-amount {
      font-weight: bold;
      font-size: 16px;
      color: #ffd700;
    }
    .action-btn {
      width: 32px;
      height: 32px;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      margin: 0 2px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background-color: #00bfa6;
      color: white;
    }
    #toplamHarcamalar {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      color: #ff4b4b;
      margin-top: 20px;
    }
  </style>
</head>
<body>
<div class="container">

  <div class="box">
    <h2>üí∞ Ba≈ülangƒ±√ß Kasasƒ±</h2>
    <input type="number" id="bakiye" placeholder="√ñrn: 1760" oninput="updateBalance(); saveLocal()">
    <div class="balance" id="kalanKasa">Kalan Kasa: ‚Ç∫0,00</div>
  </div>

  <div class="box">
    <h3>Yeni Harcama Ekle / G√ºncelle</h3>
    <select id="kategori">
      <option value="ofis">Ofis Harcamasƒ±</option>
      <option value="rent">Rent A Car Harcamasƒ±</option>
    </select>
    <input type="date" id="tarih">
    <input type="text" id="aciklama" placeholder="A√ßƒ±klama">
    <input type="number" id="tutar" placeholder="Tutar (‚Ç∫)">
    <select id="fis">
      <option value="Var">Fi≈ü Var</option>
      <option value="Yok">Fi≈ü Yok</option>
    </select>
    <button onclick="saveEntry()">üíæ Kaydet</button>
    <button onclick="resetAllData()">üóëÔ∏è Verileri Sƒ±fƒ±rla</button>
    <button onclick="downloadPDF()">üìÑ PDF'e Aktar</button>
  </div>

  <div class="tables" id="pdfArea">
    <div class="box half">
      <div class="header-title">
        <h3>üìÅ Ofis Harcamalarƒ±</h3>
        <div class="total-amount" id="ofisToplamGoster">Toplam: ‚Ç∫0,00</div>
      </div>
      <table id="ofisTablosu">
        <tr><th>Tarih</th><th>A√ßƒ±klama</th><th>Tutar</th><th>Fi≈ü</th><th>ƒ∞≈ülem</th></tr>
      </table>
    </div>

    <div class="box half">
      <div class="header-title">
        <h3>üöó Rent A Car Harcamalarƒ±</h3>
        <div class="total-amount" id="rentToplamGoster">Toplam: ‚Ç∫0,00</div>
      </div>
      <table id="rentTablosu">
        <tr><th>Tarih</th><th>A√ßƒ±klama</th><th>Tutar</th><th>Fi≈ü</th><th>ƒ∞≈ülem</th></tr>
      </table>
    </div>
  </div>

  <div id="toplamHarcamalar">Toplam Harcama: ‚Ç∫0,00</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  let selectedRow = null;
  let ofisToplam = 0, rentToplam = 0;

  function saveEntry() {
    const kategori = document.getElementById("kategori").value;
    const aciklama = document.getElementById("aciklama").value;
    const tutar = parseFloat(document.getElementById("tutar").value);
    const fis = document.getElementById("fis").value;
    const tarih = document.getElementById("tarih").value || new Date().toLocaleDateString("tr-TR");

    if (!aciklama || isNaN(tutar)) {
      alert("Bilgiler eksik.");
      return;
    }

    const table = kategori === "ofis" ? document.getElementById("ofisTablosu") : document.getElementById("rentTablosu");

    if (selectedRow) {
      selectedRow.cells[1].textContent = aciklama;
      selectedRow.cells[2].textContent = `‚Ç∫${tutar.toFixed(2)}`;
      selectedRow.cells[3].textContent = fis;
      selectedRow = null;
    } else {
      const row = table.insertRow();
      row.innerHTML = `<td>${tarih}</td><td>${aciklama}</td><td>‚Ç∫${tutar.toFixed(2)}</td><td>${fis}</td>
        <td><button class="action-btn" onclick="editRow(this)">üñâ</button>
        <button class="action-btn" onclick="deleteRow(this)">üóëÔ∏è</button></td>`;
    }

    if (kategori === "ofis") ofisToplam += tutar;
    else rentToplam += tutar;

    updateBalance();
    saveLocal();
    document.getElementById("aciklama").value = "";
    document.getElementById("tutar").value = "";
    sortTableByDate(table);

  }

  function editRow(btn) {
    selectedRow = btn.parentElement.parentElement;
    document.getElementById("aciklama").value = selectedRow.cells[1].textContent;
    document.getElementById("tutar").value = selectedRow.cells[2].textContent.replace("‚Ç∫", "");
    document.getElementById("fis").value = selectedRow.cells[3].textContent;
  }

  function deleteRow(btn) {
    const row = btn.parentElement.parentElement;
    const tutar = parseFloat(row.cells[2].textContent.replace("‚Ç∫", ""));
    const isOfis = row.parentElement.parentElement.id === "ofisTablosu";
    row.remove();

    if (isOfis) ofisToplam -= tutar;
    else rentToplam -= tutar;

    updateBalance();
    saveLocal();
  }

  function updateBalance() {
    const bakiye = parseFloat(document.getElementById("bakiye").value) || 0;
    const kalan = bakiye - (ofisToplam + rentToplam);
    const toplam = ofisToplam + rentToplam;
    document.getElementById("kalanKasa").textContent = `Kalan Kasa: ‚Ç∫${kalan.toFixed(2)}`;
    document.getElementById("ofisToplamGoster").textContent = `Toplam: ‚Ç∫${ofisToplam.toFixed(2)}`;
    document.getElementById("rentToplamGoster").textContent = `Toplam: ‚Ç∫${rentToplam.toFixed(2)}`;
    document.getElementById("toplamHarcamalar").textContent = `Toplam Harcama: ‚Ç∫${toplam.toFixed(2)}`;
  }

  function saveLocal() {
    const data = {
      bakiye: document.getElementById("bakiye").value,
      ofis: document.getElementById("ofisTablosu").innerHTML,
      rent: document.getElementById("rentTablosu").innerHTML,
      ofisToplam,
      rentToplam
    };
    localStorage.setItem("kasaData", JSON.stringify(data));
  }

  function loadLocal() {
    const data = JSON.parse(localStorage.getItem("kasaData"));
    if (data) {
      document.getElementById("bakiye").value = data.bakiye;
      document.getElementById("ofisTablosu").innerHTML = data.ofis;
      document.getElementById("rentTablosu").innerHTML = data.rent;
      ofisToplam = data.ofisToplam || 0;
      rentToplam = data.rentToplam || 0;
      updateBalance();
    }
  }

  async function downloadPDF() {
    const area = document.getElementById("pdfArea");
    const canvas = await html2canvas(area, { scale: 3, width: area.scrollWidth });
    const imgData = canvas.toDataURL("image/png");
    const toplamYazi = document.getElementById("toplamHarcamalar").textContent;

    const pdf = new window.jspdf.jsPDF("landscape", "pt", "a4");
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const imgProps = { width: canvas.width, height: canvas.height };
    const ratio = pdfWidth / imgProps.width;
    const pdfHeight = imgProps.height * ratio;

    pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
    pdf.setFont("helvetica", "bold");
    pdf.setFontSize(18);
    pdf.setTextColor(255, 0, 0);
    pdf.text(toplamYazi, pdfWidth / 2, pdfHeight + 30, { align: "center" });
    pdf.save("harcamalar-raporu.pdf");
  }

  
  function resetAllData() {
    if (confirm("T√ºm harcama kayƒ±tlarƒ± silinecek. Emin misin?")) {
      document.getElementById("ofisTablosu").innerHTML = "<tr><th>Tarih</th><th>A√ßƒ±klama</th><th>Tutar</th><th>Fi≈ü</th><th>ƒ∞≈ülem</th></tr>";
      document.getElementById("rentTablosu").innerHTML = "<tr><th>Tarih</th><th>A√ßƒ±klama</th><th>Tutar</th><th>Fi≈ü</th><th>ƒ∞≈ülem</th></tr>";
      ofisToplam = 0;
      rentToplam = 0;
      updateBalance();
      saveLocal();
    }
  }

  
  function exportToExcel() {
    const wb = XLSX.utils.book_new();
    const ofisTable = document.getElementById("ofisTablosu");
    const rentTable = document.getElementById("rentTablosu");
    const ofisSheet = XLSX.utils.table_to_sheet(ofisTable);
    const rentSheet = XLSX.utils.table_to_sheet(rentTable);
    XLSX.utils.book_append_sheet(wb, ofisSheet, "Ofis Harcamalarƒ±");
    XLSX.utils.book_append_sheet(wb, rentSheet, "Rent A Car Harcamalarƒ±");
    XLSX.writeFile(wb, "kasa-harcamalari.xlsx");
  }

  
  function sortTableByDate(table) {
    const rows = Array.from(table.rows).slice(1);
    rows.sort((a, b) => {
      const dateA = new Date(a.cells[0].textContent.split('.').reverse().join('-'));
      const dateB = new Date(b.cells[0].textContent.split('.').reverse().join('-'));
      return dateA - dateB;
    });
    rows.forEach(row => table.appendChild(row));
  }

  window.onload = loadLocal;
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
